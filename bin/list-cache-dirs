#!/bin/sh

function find_tmpfs_cache_directories() {
    LC_ALL=C find "$1" -maxdepth 1 -lname '/tmp/caches/*' -exec ls -ld '{}' + | LC_ALL=C awk '{print "    " $9 " " $10 " " $11}'
}

function find_cache_directories() {
    LC_ALL=C find "$1" -maxdepth 1 -lname '/caches/*' -exec ls -ld '{}' + | LC_ALL=C awk '{print "    " $9 " " $10 " " $11}'
}

function get_size() {
    LC_ALL=C du -sh "$1" | LC_ALL=C awk '{print $1}'
}

function print_bold() {
    echo -e "\e[1m$1\e[0m"
}

print_bold "Persistent caches in ~"
find_cache_directories "$HOME"
print_bold "Persistent caches in ~/.cache"
find_cache_directories "$HOME/.cache"

echo

print_bold "Temporary (tmpfs) caches in ~"
find_tmpfs_cache_directories "$HOME"
print_bold "Temporary (tmpfs) caches in ~/.cache"
find_tmpfs_cache_directories "$HOME/.cache"

echo

print_bold "Available caches on the compressed disk image"
cache_directories=( $(LC_ALL=C find "/caches/1000" -maxdepth 1) ) # -exec ls -ld '{}' + | LC_ALL=C awk '{print "    " $9}'
for dir in "${cache_directories[@]}"; do
    echo "    $dir ($(get_size "$dir"))"
done

echo

print_bold "BTRFS stats"
btrfs filesystem df -H /caches/1000
btrfs filesystem usage -H /caches/1000
